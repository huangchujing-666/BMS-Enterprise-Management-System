@model List<pbxdata.model.AttributeModel>

<script src="~/js/jquery-1.8.2.min.js" type="text/javascript"></script>
<link href="~/Css/divShow.css" rel="stylesheet" />
<style type="text/css">
    #AttributeList input[type=text]
    {
        width: 70px;
        border: none;
    }

    .divAddbtn
    {
        height: 30px;
        text-indent: 15px;
        line-height: 30px;
    }

        .divAddbtn a
        {
            text-decoration: none;
        }

            .divAddbtn a:hover
            {
                text-decoration: underline;
            }

    #UpdatePop
    {
        top: 10%;
        left: 30%;
        width: 300px;
        height: 200px;
    }

    #AddPop
    {
        top: 10%;
        left: 30%;
        width: 300px;
        height: 200px;
    }

    #AddsPop
    {
        top: 10%;
        left: 10%;
        width: 800px;
        height: 535px;
    }

    .PopContent
    {
        height: 130px;
        width: 99%;
        padding-top: 15px;
    }

    #mytable
    {
        min-width: 100%;
    }

        #mytable a
        {
            margin-left: 10px;
            text-decoration: none;
        }

            #mytable a:hover
            {
                text-decoration: underline;
            }

    #mytable1
    {
        min-width: 100%;
    }
</style>
<div class="divAddbtn"><a href="#" onclick="AddAttr('@ViewData["TypeNo"]')">添加属性</a><a href="#" style="margin-left: 15px" onclick="AddAttris()">导入属性</a></div>

<div id="AttributeDiv">
    <div style="float: left;min-width: 40%;">
        <div style="text-align: center;font-weight:bold;font-size:1.5em">系统属性对应淘宝属性</div>
        <table id="mytable" class="mytable">
        </table>
    </div>
    <div style="float: left; margin-left: 50px;min-width: 40%;">
        <div style="text-align: center;font-weight:bold;font-size:1.5em">系统属性已绑定淘宝属性</div>
        <table id="mytable1" class="mytable">
        </table>
    </div>
</div>
<div class="PopBg" style="width: 99%">
</div>
<input type="hidden" id="hidTypeNo" value="@ViewData["TypeNo"]" />
<div id="UpdatePop" class="myPopdiv">
    <div style="text-indent: 10px; text-align: left;">修改属性名称</div>
    <div class="PopContent">
        属性名称:<input id="txtPropertyName" type="text" value="" />
        <input id="HiddenId" type="hidden" value="" />
    </div>
    <div style="text-align: center; margin-top: 10px;">
        <input type="button" value="确定" onclick="UpdateAttri()" /><input type="button" value="取消" onclick="    Close()" style="margin-left: 20px" />
    </div>
</div>
<div id="AddPop" class="myPopdiv">
    <div style="text-indent: 10px; text-align: left;">添加属性</div>
    <div class="PopContent">
        属性名称:<input id="txtPropertyNameAdd" type="text" value="" />
        <input id="HiddenIdAdd" type="hidden" value="" />
    </div>
    <div style="text-align: center; margin-top: 10px;">
        <input type="button" value="确定" onclick="SaveAddAttr()" /><input type="button" value="取消" onclick="    Close()" style="margin-left: 20px" />
    </div>
</div>
<div id="AddsPop" class="myPopdiv">
    <iframe id="ifrUploadExcell" src="~/ReaderExcel/HomePage" style="width: 100%; height: 100%; border: none;"></iframe>
    @*<input id="HiddenIdAdds" type="hidden" value="" />
        <input id="FileUpload" type="file" name="FileUpload" style="width: 250px; background: White" class="easyui-validatebox" validtype="length[1,100]" />
        <div style="text-align: center; margin-top: 10px;">
            <input type="submit" value="确定" onclick="SaveAddsAttr()" /><input type="button" value="取消" onclick="    Close()" style="margin-left: 20px" />
        </div>*@
</div>
<script type="text/javascript">
    /*弹出编辑页面*/
    function Edit(Id, PropertyName) {
        $(".PopBg").height($(document).height());
        $(".PopBg").show();
        $("#UpdatePop").show();
        $("#txtPropertyName").val(PropertyName)
        $("#HiddenId").val(Id)
    }
    /*删除属性*/
    function Delete(Id) {
        $.ajax({
            type: "GET",
            url: "/Product/DeleteAttribute?Id=" + Id,
            success: function (data) {
                if (data != -1) {
                    alert("删除成功");
                }
                else {
                    alert("删除失败！");
                }
                GetAttribute();
            },
            error: function () {
                alert("error")
            },
        })
    }
    /*关闭弹窗*/
    function Close() {
        $(".PopBg").hide();
        $(".myPopdiv").hide();
    }
    /*弹出添加属性*/
    function AddAttr(TypeNo) {
        $(".PopBg").height($(document).height() - 28);
        $(".PopBg").show();
        $("#AddPop").show();
        $("#HiddenIdAdd").val(TypeNo)
    }
    /*保存新增属性*/
    function SaveAddAttr() {
        var PropertyName = $("#txtPropertyNameAdd").val();
        var TypeNo = $("#HiddenIdAdd").val();
        $.ajax({
            type: "GET",
            url: "/Product/AddAttribute?TypeNo=" + TypeNo + "&PropertyName=" + PropertyName,
            success: function (data) {
                if (data != -1) {
                    alert("添加成功");
                }
                else {
                    alert("名字重复添加失败！");
                }
                GetAttribute();
            },
            error: function () {
                alert("error")
            },
        })

    }
    /*弹出导入属性界面*/
    function AddAttris() {
        $(".PopBg").height($(document).height());
        $(".PopBg").show();
        $("#AddsPop").show();

    }
    /*确定导入*/
    function UpdateAttri() {
        var PropertyName = $("#txtPropertyName").val();
        var Id = $("#HiddenId").val();

        $.ajax({
            type: "GET",
            url: "/Product/EditAttribute?Id=" + Id + "&PropertyName=" + PropertyName,
            success: function (data) {
                if (data != -1) {
                    alert("修改成功");
                }
                else {
                    alert("修改失败");
                }
                GetAttribute();
            },
            error: function () {
                alert("error")
            },
        })
    }

    /*检测导入文件*/
    function SaveAddsAttr() { 
        var file = ($("#FileUpload").val());
        if (file == "") {
            $.messager.alert('系统提示', '请选择将要上传的文件!');
            return false;
        }
        else {
            var stuff = file.match(/^(.*)(\.)(.{1,8})$/)[3];
            if (stuff != 'xls') {
                alert('文件类型不正确，请选择.xls文件!');
                return false;
            }
            else {
                document.forms[0].submit();
            }
        }
    }
    $(function () {
        //alert(document.getElementById('ifrUploadExcell').contentWindow.document.getElementById('divClose').innerHTML)
        //$('#ifrUploadExcell').contents().find('body').find('#divClose').click(function () {
        //    alert("close");
        //})
        //alert($("#ifrUploadExcell").contents().find("body").find("#divClose").html())
        //document.getElementById('ifrUploadExcell').contentWindow.document.getElementById('divClose').onclick = function () {
        //    alert("123")
        //}

    })
    /*返回父页面*/
    function ReturnParent() {
        location.href = "/Product/UpdateAttribute?TypeNo=@ViewData["TypeNo"]";
    }
    
    GetAttribute();
    /*获取所有属性*/
    function GetAttribute() {
        $.ajax({
            type: "GET",
            url: "/Product/GetAttribute?TypeNo=@ViewData["TypeNo"]",
            success: function (data) {
                $("#mytable").html(data)
                SaveTBcid();
                selTBProperty();
                GetTBProductPro();
            },
            error: function () {
                alert("error!")
            },
        })
    }
    /*获取所有淘宝属性*/
    function GetTBProductPro() {
        $.ajax({
            type: "GET",
            url: "/Product/GetTBProductPro?TypeNo=@ViewData["TypeNo"]",
            success: function (data) {
                $("#mytable1").html(data)
            },
            error: function () {
                alert("error!")
            },
        })
    }
    /*保存修改的淘宝属性*/
    function SaveTBcid() {
        $(".SaveTBcid").each(function () {
            $(this).click(function () {
                var vid = $(this).parent().parent().find(".tdvid").html()
                var Id = $(this).attr("name").trim();
                $.ajax({
                    type: "GET",
                    url: "/Product/SaveTBVid?Id=" + Id + "&vid=" + vid + "&TypeNo=@ViewData["TypeNo"]",
                    success: function (data) {
                        if (data != "") {
                            alert(data)
                        }
                        GetTBProductPro();
                    },
                    error: function () {
                        alert("error!")
                    },


                })
            })
        })
    }
    /*选择淘宝属性并显示对应编号*/
    function selTBProperty() {
        $(".selTBProducttype").each(function () {
            $(this).change(function () {
                var vid = $(this).find("option:selected").val();
                $(this).parent().parent().find(".tdvid").html(vid)
            })
        })
    }
</script>

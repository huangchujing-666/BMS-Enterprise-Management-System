<script src="~/js/jquery-1.8.2.min.js"></script>
<script src="~/js/pageIndex.js"></script>
<link href="~/Css/divShow.css" rel="stylesheet" />
<link href="~/Css/All.css" rel="stylesheet" />
<link href="~/Css/Search.css" rel="stylesheet" />
<script type="text/javascript">
    $(function ()
    {
        $("#ShopSerach").click(function ()
        {
            var ShopName = $("#Shop").val();
            var ShopType = $("#SeracheShopType").val();
            var ManagerName = $("#SerachUserNmae").val();
            var Params = "{ ShopName: '" + ShopName + "', ShopType: '" + ShopType + "', ManagerName: '" + ManagerName + "'}";
            $.post("/ShopManager/ShopPageIndex", {
                menuId: "@ViewData["myMenuId"]",
                pageIndex: 1,
                pageSize: 10,
                params: Params,
            }, function (data) { $("#ShopTypeTb").html(""); var ss = data.split("-----"); $("#ShopTypeTb").append(ss[0]); $("#PageCount").html(ss[1]); $("#AllCounts").html(ss[2]); })
            var b = $.PageFunc("/ShopManager/ShopPageIndex", "@ViewData["myMenuId"]", Params);
            $("#spanPage").html(b);
            $("#txtTiao").val(1);
            $("#PageNum").html(1);
        })
    })


    ///删除店铺
    function DeleteShop(Id) {
        if (confirm("确认删除店铺？")) {
            $.ajax(
                {
                    type: "POST",
                    url: "/ShopManager/DeleteShop",
                    datatype: "text",
                    data: { "Id": Id },
                    success: function (data) {
                        alert(data);
                        Refresh();
                    }
                })
        }
    }
    //添加店铺
    function AddShop() {
        $(".PopBg").height($(document).height());
        $(".PopBg").show();

        $("#Insert").show();
    }
    //关闭添加弹窗
    function CloseAdd() {
        $(".PopBg").hide();
        $("#Insert").hide();
    }
    ///店铺添加信息
    function InsertShop() {
        var ShopState = $("input[name='Choose']:checked").val();
        var shopname = $("#ShopName").val();
        var ShopType = $("#ShopType").val();
        var UserId = $("#UserNmae").val();
        var Telphone = $("#Telphone").val();
        $.ajax(
            {
                type: "POST",
                url: "/ShopManager/InsertShop",
                datatype: "text",
                data: {
                    "ShopState": ShopState,
                    "shopname": shopname,
                    "ShopType": ShopType,
                    "UserId": UserId,
                    "Telphone": Telphone
                },
                success: function (data) {
                    alert(data)
                    CloseAdd();
                    Refresh();
                }
            })
    }
    //启用店铺
    function Enabled(Id) {
        if (confirm("确定需要启用店铺？")) {
            $.ajax(
                {
                    type: "POST",
                    url: "/ShopManager/EnabledShop",
                    datatype: "text",
                    data: { "Id": Id },
                    success: function (data) {
                        alert(data);
                        Refresh();
                    }
                })
        }
    }
    //停用店铺
    function disable(Id) {
        if (confirm("确定需要停用店铺？")) {
            $.ajax(
                {
                    type: "POST",
                    url: "/ShopManager/disableShop",
                    datatype: "text",
                    data: { "Id": Id },
                    success: function (data) {
                        alert(data);
                        Refresh();
                    }
                })
        }
    }
    //修改店铺
    function UpdateShop(Id) {
        $.ajax(
            {
                type: "POST",
                datatype: "text",
                url: "/ShopManager/UpdateShop",
                data: {
                    "Id": Id,
                    "MenuId": "@ViewData["myMenuId"]"
                },
                success: function (data) {
                    $("#Update").html(data);
                    $(".PopBg").height($(document).height());
                    $(".PopBg").show();
                    $("#Update").show();
                }
            })
    }
    //退出编辑
    function Close() {
        $(".PopBg").hide();
        $(".myPopdiv").hide();
    }
    //确认修改店铺
    function UpdateShopName() {
        var id = $("#Id").val();
        var shopname = $("#ShopName").val() != "" ? $("#ShopName").val() : "";
        var shoptype = $("#ShopType").val() != "" ? $("#ShopType").val() : "";
        var shopmanager = $("#Manager").val() != "" ? $("#Manager").val() : "";
        var ShopState = $("input[name='ChooseName']:checked").val() != "" ? $("input[name='ChooseName']:checked").val() : "1";
        $.ajax(
            {
                type: "POST",
                datatype: "text",
                url: "/ShopManager/UpdateShopOk",
                data: {
                    "shopname": shopname,
                    "Id": id,
                    "shoptype": shoptype,
                    "shopmanager": shopmanager,
                    "shopstate": ShopState
                },
                success: function (data) {
                    alert(data)
                    Close()
                    Refresh()
                }
            })
    }



</script>
<style type="text/css">
    #Insert
    {
        width: 400px;
        height: 200px;
    }
</style>
<div id="Search">
    <span class="spanProperty">
        <span class="spanPropertyName">店铺名称：</span>
        <input type="text" id="Shop"  class="spanPropertyValue"/>
    </span>
    <span>
        <span class="spanPropertyName">店铺类别</span>
        <select id="SeracheShopType" class="spanPropertyValue">@Html.Raw(ViewData["ShopType"])</select>
    </span>
    <span>
        <span class="spanPropertyName">店铺管理人</span>
        <select id="SerachUserNmae" class="spanPropertyValue">@Html.Raw(ViewData["User"])</select>
    </span>
    <input type="button" id="ShopSerach" value="查询" class="spanPropertySearch" />
    <input type="button" value="添加" class="spanPropertySearch" onclick="AddShop()" />
</div>
<div id="ShopTypeTb">
</div>
<div class="divJump" id="divJump">
    <span id="spanPage" style="font-weight:400;"></span>
    共 <span id='PageCount' style='color: blue'></span>页&nbsp;&nbsp;
    当前第 <span id='PageNum' style='color: blue'>1</span> 页&nbsp;&nbsp;
    共 <span id='AllCounts' style='color: blue'></span>条数据
</div>
<div class="PopBg"></div>
<div class="myPopdiv" style="left: 30%; width: auto;" id="Insert">
    <div class="divclose" onclick="Close()">×</div>
    <div class="Poptitle">添加店铺</div>
    <div class="PopContent">
        <table>
            <tr>
                <td>店铺名称</td>
                <td>
                    <input type="text" id="ShopName" /></td>
                <td>店铺类别</td>
                <td><select id="ShopType">@Html.Raw(ViewData["ShopType"])</select> </td>
            </tr>
            <tr>
                <td>店铺状态</td>
                <td>
                    <input type="radio" id="Enable" name="Choose" value="1" />启用<input type="radio" id="disable" name="Choose" value="0" />暂不启用</td>
            </tr>
            <tr>
                <td>店铺管理人</td>
                <td><select id="UserNmae">@Html.Raw(ViewData["User"])</select></td>
                <td>联系电话</td>
                <td>
                    <input type="text" id="Telphone" /></td>
            </tr>
        </table>
        <input type="button" value="确认添加" id="Submit" onclick="InsertShop()" /><input type="button" value="退出添加" style="margin-left: 50px;" onclick="    CloseAdd()" id="Exit" />
        <br />
        <br />
    </div>
</div>
<div class="myPopdiv" style="left: 30%;" id="Update"></div>
<script type="text/javascript">
    function selPage(url, menuid, obj) {
        var params = JSON.stringify(obj).replace(/\"/g, "'");
        console.log(obj);
        $.post(url, {
            menuId: menuid,
            pageIndex: 1,
            pageSize: $("#selPages").val(),
            params: params,
        }, function (data) { $("#ShopTypeTb").html(""); var ss = data.split("-----"); $("#ShopTypeTb").append(ss[0]); $("#PageCount").html(ss[1]); $("#AllCounts").html(ss[2]); })
    }
</script>
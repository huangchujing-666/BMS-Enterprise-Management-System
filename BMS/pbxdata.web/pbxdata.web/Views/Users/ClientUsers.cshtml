<script src="~/js/jquery-1.8.2.min.js"></script>
<script src="~/js/divShow.js"></script>
<link href="~/Css/divShow.css" rel="stylesheet" />
<style type="text/css">
    *
    {
        font-size:12px;
    }
     header
    {
        border: 1px solid #DDDDDD;
        background-color: #F4F4F4;
        height: 30px;
        line-height: 30px;
        padding-left: 15px;
        padding:2px;
    }

        header a
        {
            display: inline-block;
            height: 25px;
            width: 80px;
            text-align: center;
            line-height: 25px;
            margin-top: 2px;
            text-decoration: none;
        }

            header a:hover
            {
                border: 1px solid lightblue;
                border-radius: 5px;
            }

    .divSearch
    {
        text-align: left;
        padding-left: 20px;
    }
    input[type=text],select
    {
         width: 150px;
    }
        .divSearch input[type=text], .divSearch select
        {
            height: 25px;
            width: 150px;
            vertical-align: middle;
        }

    #selVencode
    {
        margin-top: 2px;
    }

    .btn6
    {
        margin-left: 20px;
    }

    .divContainer
    {
        text-align: left;
        overflow: hidden;
    }

    .divJump
    {
        text-align: left;
    }

    .mytable
    {
        width: 720px;
        border:1px solid black;
    }

        .mytable th, .mytable td
        {
            height: 20px;
            min-width: 80px;
            text-align: left;
        }
          .divclose
    {
        position: absolute;
        right: 8px;
        top: 3px;
        cursor: pointer;
        font-size: 2em;
        font-weight: bolder;
        width: 30px;
        height: 30px;
    }

        .divclose:hover
        {
            color: red;
        }

    #PopEditContent, #PopAddContent
    {
        left: 40%;
        top: 40%;
        width: 300px;
        min-height: 200px;
    }

    .PopContent
    {
        margin-top: 5px;
        border: 1px solid lightblue;
        height: 180px;
        width: 99%;
        background-color: white;
        padding-top: 15px;
    }

        .PopContent div
        {
            margin-top: 5px;
        }

</style>
<h2>客户端用户管理</h2>
<header class="divSearch">
    用户名:<input type="text" id="txtUserName" />
    数据源:<select id="selVencode"></select><input type="button" value=" 查    询 " class="btn6" onclick="OnSearch()" />
    <a href="#" onclick="AddClick()" style="margin-left: 10px">添    加</a>
</header>
<div class="divContainer">
    <table id="mytable" class="mytable" border="1" cellpadding="0" cellspacing="0">
    </table>
    <div class="divJump">
            <select id="selPages" onchange="selPage()">
                <option>5</option>
                <option selected="selected">10</option>
                <option>20</option>
                <option>50</option>
                <option>100</option>
            </select>

            <a href="#" onclick="TurnPage(1)">首页</a>
            <a href="#" onclick="TurnPage(2)">上一页</a>
            <input type="text" id="txtTiao" value="" style="width: 35px;" />
            <a href="#" onclick="TurnPage(3)">下一页</a>
            <a href="#" onclick="TurnPage(4)">尾页</a>
            @*@Html.TextBox("txtTiao","", new { style = "width:20px;", onkeyup = "OnTiaoChange();" })*@
            <a href="#" onclick="TurnPage(5)">跳转</a>
            共<span id="PageCount"></span>页&nbsp;&nbsp;当前第<span id="PageNum" ></span>页&nbsp;&nbsp; 共<span id="AllCounts" ></span>条数据
    </div>
</div>
<div id="PopEditContent" class="myPopdiv">
    <div class="divclose" onclick="Close()">×</div>
    <div style="text-indent: 10px; text-align: left;">修改用户信息</div>
    <div class="PopContent">
        <div>用户名：<input id="txtEditUserName" type="text" disabled="disabled" /></div>
        <div>&nbsp;密码：<input id="txtEditPassWord" type="text" title="" /></div>
        <div>&nbsp;邮箱：<input id="txtEditEmail" type="text" title="" /></div>
        <div>数据源：<select id="selEditVencode"></select></div>
        <div style="text-align: center">
            <input type="button" name="Update" value=" 保  存 " onclick="UpdateClientUsers()" /><input type="button" name="Close" value=" 关  闭 " onclick="    Close()" style="margin-left: 50px" />
        </div>
    </div>
</div>
<div id="PopAddContent" class="myPopdiv">
    <div class="divclose" onclick="Close()">×</div>
    <div style="text-indent: 10px; text-align: left;">添加用户信息</div>
    <div class="PopContent">
        <div>用户名：<input id="txtAddUserName" type="text" /></div>
        <div>&nbsp;密码：<input id="txtAddPassWord" type="text" title="" /></div>
        <div>&nbsp;邮箱：<input id="txtAddEmail" type="text" title="" /></div>
        <div>数据源：<select id="selAddVencode"></select></div>
        <div style="text-align: center">
            <input type="button" name="Update" value=" 保  存 " onclick="AddClientUsers()" /><input type="button" name="Close" value=" 关  闭 " onclick="    Close()" style="margin-left: 50px" />
        </div>
    </div>
</div>
<div class="PopBg"></div>


<script type="text/javascript">
    /*获取供应商编码下拉表*/
    $.ajax({
        type: "GET",
        url: "/Category/GetVencodelist?SourceCode=0",
        success: function (data) {
            $("#selVencode").html(data)
        },
        error: function () {
        },
    })
    /*搜索*/
    function OnSearch() {
        GetTable(1, $("#selPages").val().trim());
        $("#txtTiao").val(1);
        $("#PageNum").html(1);
    }
    /*获得table*/
    function GetTable(Page, selpages) {
        var UserName = $("#txtUserName").val().trim();
        var Vencode = $("#selVencode").find("option:selected").val();
        $.ajax({
            type: "POST",
            url: "/Users/GetClientUsersTable",
            data: { "UserName": UserName, "Vencode": Vencode, "Page": Page, "selpages": selpages },
            success: function (data) {
                selpages = selpages * 1;
                var tabledata = [];
                var tabledata = data.split("-*-");
                $("#mytable").html(tabledata[0]);
                $("#AllCounts").html(tabledata[1])
                $("#PageCount").html(Math.ceil(tabledata[1] * 1 / selpages))
            },
            error: function () {
            },
        })
    }
    
    function selPage() {//---------设置显示数目
        $("#txtTiao").val(1);
        $("#PageNum").html(1);
        GetTable(1, $("#selPages").val().trim())
    }
    /*跳转*/
    function TurnPage(obj) {//-----翻页---
        var pages = $("#selPages").val().trim();
        switch (obj) {
            case 1: GetTable(0, pages);//----首页
                $("#txtTiao").val(1);
                $("#PageNum").html(1)
                break;
            case 2:;//----上一页
                if ($("#txtTiao").val().trim() == "1") {
                    return false;
                }
                else {
                    GetTable($("#txtTiao").val().trim() * 1 - 1, pages)
                    $("#txtTiao").val($("#txtTiao").val().trim() * 1 - 1);
                    $("#PageNum").html($("#txtTiao").val().trim())
                }
                break;
            case 3://----下一页
                if ($("#txtTiao").val().trim() == $("#PageCount").html()) {
                    return false;
                }
                else {
                    GetTable($("#txtTiao").val().trim() * 1 + 1, pages);
                    $("#txtTiao").val($("#txtTiao").val().trim() * 1 + 1);
                    $("#PageNum").html($("#txtTiao").val().trim())
                }

                break;
            case 4: GetTable($("#PageCount").html(), pages);//----尾页

                $("#txtTiao").val($("#PageCount").html());
                $("#PageNum").html($("#PageCount").html())
                break;
            case 5: GetTable($("#txtTiao").val().trim(), pages);//----跳转
                $("#PageNum").html($("#txtTiao").val().trim());

                break;

        }
    }

    /*关闭按钮取消修改*/
    function Close() {
        $(".PopBg").hide();
        $(".myPopdiv").hide();
    }
    /*编辑用户信息*/
    function EditClientUsers(UserName, PassWord, Vencode,Email) {
        $(".PopBg").height($(document).height());
        $(".PopBg").show();
        $("#PopEditContent").show();
        $("#txtEditUserName").val(UserName);
        $("#txtEditPassWord").val(PassWord);
        $("#txtEditEmail").val(Email);
        $.ajax({
            type: "GET",
            url: "/Category/GetVencodelist?SourceCode=" + Vencode,
            success: function (data) {
                $("#selEditVencode").html(data)
            },
            error: function () {
            },
        })
    }
    /*编辑用户信息*/
    function UpdateClientUsers() {
        var UserName=$("#txtEditUserName").val().trim();
        var PassWord = $("#txtEditPassWord").val().trim();
        var Vencode = $("#selEditVencode").find("option:selected").val();
        var Email=$("#txtEditEmail").val().trim();
        if (UserName == "" || PassWord == "" || Vencode == "") {
            $.MsgBox.Alert("提示", "必须填写所有信息！");
            return false;
        }
        $.ajax({
            type: "POST",
            url: "/Users/UpdateClientUsers",
            data: { "UserName": UserName, "PassWord": PassWord, "Vencode": Vencode, "Email": Email },
            success: function (data) {
                $.MsgBox.Alert("提示", data);
                GetTable($("#txtTiao").val().trim(), $("#selPages").val().trim());
            },
            error: function () {
            },
        })
    }
    /*删除用户*/
    function DeleteClientUsers(UserName) {
        $.MsgBox.Confirm("提示", "确定要删除用户" + UserName + "吗？", function () {
            $.ajax({
                type: "POST",
                url: "/Users/DeleteClientUsers",
                data: { "UserName": UserName },
                success: function (data) {
                    if (data != "") {
                        $.MsgBox.Alert("提示", data);
                    }
                    GetTable($("#txtTiao").val().trim(), $("#selPages").val().trim());
                },
                error: function () {
                },
            })
        })
    }
    function AddClick() {
        $(".PopBg").height($(document).height());
        $(".PopBg").show();
        $("#PopAddContent").show();
        $("#txtAddUserName").val("");
        $("#txtAddPassWord").val("");
        $("#txtAddEmail").val();
        $.ajax({
            type: "GET",
            url: "/Category/GetVencodelist?SourceCode=0",
            success: function (data) {
                $("#selAddVencode").html(data)
            },
            error: function () {
            },
        })
    }
    /*添加用户*/
    function AddClientUsers() {
        var UserName = $("#txtAddUserName").val().trim();
        var PassWord = $("#txtAddPassWord").val().trim();
        var Email= $("#txtAddEmail").val().trim();
        var Vencode = $("#selAddVencode").find("option:selected").val();
        if (UserName == "" || PassWord == "" || Vencode == "" || Email=="") {
            $.MsgBox.Alert("提示", "必须填写所有信息！");
            return false;
        }
        $.ajax({
            type: "POST",
            url: "/Users/AddClientUsers",
            data: { "UserName": UserName, "PassWord": PassWord, "Vencode": Vencode ,"Email": Email },
            success: function (data) {
                $.MsgBox.Alert("提示", data);
                GetTable($("#txtTiao").val().trim(), $("#selPages").val().trim());
            },
            error: function () {
            },
        })
    }
</script>

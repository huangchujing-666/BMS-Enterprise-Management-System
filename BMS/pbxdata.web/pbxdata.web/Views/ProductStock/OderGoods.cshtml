<script src="~/js/jquery-1.8.2.min.js"></script>
<script src="~/js/pageIndex.js"></script>
<link href="~/Css/divShow.css" rel="stylesheet" />
<link href="~/Css/All.css" rel="stylesheet" />
<link href="~/Css/Search.css" rel="stylesheet" />
<script type="text/javascript" src="~/js/My97DatePicker/WdatePicker.js"></script>


<script src="~/js/DropDowndiv.js"></script>

<script type="text/javascript">
    ///打开新增订单界面
    function NewOrder() {
        $.ajax(
            {
                type: "post",
                url: "/ProductStock/OrderNo",
                datatype: "text",
                success: function (data) {
                    $("#OrderNo").html(data);
                    $("#Insert").show();
                }
            })
    }
    ///关闭新增订单界面
    function ColseInsert() {
        $(".myPopdiv").hide();
    }
    ///确认新增订单
    function OkOrder() {
        var OrderNo = $("#OrderNo").html() == null ? "" : $("#OrderNo").html();
        var OrderUser = $("#OrderUser").val() == null ? "" : $("#OrderUser").val();
        var DrpBrand = $("#BrandS").find("option:selected").val() == null ? "" : $("#BrandS").find("option:selected").val();
        var OrderTime = $("#OrderTime").val() == null ? "" : $("#OrderTime").val();
        var ExpectTime = $("#ExpectTime").val() == null ? "" : $("#ExpectTime").val();
        $.ajax(
            {
                type: "post",
                url: "/ProductStock/InsertOrderGoods",
                datatype: "text",
                data:
                    {
                        "OrderNo": OrderNo,
                        "OrderUser": OrderUser,
                        "DrpBrand": DrpBrand,
                        "OrderTime": OrderTime,
                        "ExpectTime": ExpectTime,

                    },
                success: function (data) {
                    alert(data);
                    Search()
                    ColseInsert()
                }
            })
    }
    ///提交数据
    function TestSubmit(OrderId) {
        var ajax_option = {
            success: function (data) {
                alert("aaa" + data);
            },
            error: function (a, b, c) {
                alert(b);
            },
            complete: function (XMLHttpRequest, textStatus) {
                alert(textStatus);
            }
        }
        $("#" + OrderId).ajaxSubmit();
    }


    $(function ()
    {
        $("#Search").click(function ()
        {
            var OrderId = $("#OrderId").val();
            var Brand = $("#Brand").val();
            var MinTime = $("#MinTime").val();
            var MaxTime = $("#MaxTime").val();
            var Params = "{OrderId:'" + OrderId + "',Brand:'" + Brand + "',MinTime:'" + MinTime + "',MaxTime:'" + MaxTime + "'}";
            $.post("/Productstock/GetOrderGoods", {
                menuId: "@ViewData["myMenuId"]",
                pageIndex: 1,
                pageSize: 10,
                params: Params,
            }, function (data) { $("#OrderTable").html(""); var ss = data.split("-----"); $("#OrderTable").append(ss[0]); $("#PageCount").html(ss[1]); $("#AllCounts").html(ss[2]); })
            var b = $.PageFunc("/ProductStock/GetOrderGoods", "@ViewData["myMenuId"]", Params);
            $("#spanPage").html(b);
            $("#txtTiao").val(1);
            $("#PageNum").html(1);
        })
    })


    function selPage(url, menuid, obj) {
        var params = JSON.stringify(obj).replace(/\"/g, "'");
        console.log(obj);
        $.post(url, {
            menuId: menuid,
            pageIndex: 1,
            pageSize: $("#selPages").val(),
            params: params,
        }, function (data) { $("#OrderTable").html(""); var ss = data.split("-----"); $("#OrderTable").append(ss[0]); $("#PageCount").html(ss[1]); $("#AllCounts").html(ss[2]); })
    }
</script>

<div>
    <span class="spanProperty">
        <span class="spanPropertyName">订单编号：</span>
        <input type='text' id='OrderId' class="spanPropertyValue">
    </span>
    <span class="spanProperty">
        <span class="spanPropertyName">品牌：</span>
        <input type='text' id='Brand' onclick="GetDropToBrand(this.id)" class="spanPropertyValue">

    </span>
    <span class="spanProperty">
        <span class="spanPropertyName">开始时间：</span>
        <input type="text" class="spanPropertyValue" id="MinTime"  onfocus="WdatePicker({isShowWeek:true,onpicked:function() {$dp.$('d122_1').value=$dp.cal.getP('W','W');$dp.$('d122_2').value=$dp.cal.getP('W','WW');}})" />
    </span>
    <span class="spanProperty">
        <span class="spanPropertyName">结束时间：</span>
        <input type="text" class="spanPropertyValue" id="MaxTime"  onfocus="WdatePicker({isShowWeek:true,onpicked:function() {$dp.$('d122_1').value=$dp.cal.getP('W','W');$dp.$('d122_2').value=$dp.cal.getP('W','WW');}})" />
    </span>
    <br />
    <span class="spanProperty">
        <span class="spanPropertyName"><input type="button" value="查询" class="spanPropertySearch"  id="Search" /></span>
        <input type="button" class="spanPropertySearch" value="新增订单" onclick="NewOrder()" />
    </span>
      
</div>
<div id="OrderTable">
</div>
@*分页*@
<div class="divJump">
    <span id="spanPage" style="font-weight:400;"></span>
    共 <span id='PageCount' style='color: blue'></span>页&nbsp;&nbsp;
    当前第 <span id='PageNum' style='color: blue'>1</span> 页&nbsp;&nbsp;
    共 <span id='AllCounts' style='color: blue'></span>条数据
</div>



<div class="PopBg"></div>
<div class="myPopdiv" style="left: 10%; top: 20%; width: auto; height: 200px" id="Insert">
    <div class="divclose" onclick="ColseInsert()">×</div>
    <div class="Poptitle">新增订单</div>
    <div class="PopContent" style="height:80%">
        <table>
            <tr>
                <td>订单编号</td>
                <td>
                    <label id="OrderNo"></label>
                </td>
                <td>订货人</td>
                <td>
                    <input id="OrderUser" style="width: 86px;" /></td>
            </tr>
            <tr>
                <td>品牌</td>
                <td><select id="BrandS">@Html.Raw(ViewData["DrpBrand"])</select></td>
                <td>订货日期</td>
                <td>
                    <input type="text" class="Wdate" id="OrderTime" style="width: 86px;" onfocus="WdatePicker({isShowWeek:true,onpicked:function() {$dp.$('d122_1').value=$dp.cal.getP('W','W');$dp.$('d122_2').value=$dp.cal.getP('W','WW');}})" /></td>
            </tr>
            <tr>
                <td>预计到货时间</td>
                <td>
                    <input type="text" class="Wdate" id="ExpectTime" style="width: 86px;" onfocus="WdatePicker({isShowWeek:true,onpicked:function() {$dp.$('d122_1').value=$dp.cal.getP('W','W');$dp.$('d122_2').value=$dp.cal.getP('W','WW');}})" /></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td colspan="5">
                    <input type="button" value="确认" onclick="OkOrder()" /></td>
            </tr>
        </table>
    </div>
</div>
<script type="text/javascript">

    $.getDropDownList("#Brand");
    function GetDropToBrand(e) {
        if ($("#" + e).val() == "") {
            sql = 1; //"";
        } else {
            sql = 2;// "select TOP 10 TypeName,Id from Brand where TypeName like " + "'%" + $("#" + e).val() + "%'";
        }

        $.ajax({
            type: "post",
            url: "/Productstock/Brand",
            data: {
                sql: sql,
                value: $("#" + e).val()
            },
            success: function (data) {
                var d1 = eval(data);
                for (i in d1) {
                    $("#dd ul").append("<li title='" + d1[i].BrandAbridge + "'>" + d1[i].BrandName + "")
                }
                getCss(e);
            },
            error: function () {
                alert("error")
            },
        })

    }
</script>